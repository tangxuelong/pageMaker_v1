# PageMaker简介

`PageMaker` 是[乐得前端工具平台](http://nfop.ms.netease.com)中的一款在线效率工具，其目的是快速制作适用于移动平台的页面，从页面组件配置、发布、修改提供一条龙服务。

## URL地址

> 官方首页：
> [http://pagemaker.nfop.ms.netease.com](http://pagemaker.nfop.ms.netease.com)

当然，每个项目都会有一个独立域名的首页，比如 http://xxx.pagemaker.nfop.ms.netease.com。其中 xxx 代表的是登记的项目名称。

## 生效环境

> PageMaker 制作的页面可以方便在以下环境中使用：

- 移动端浏览器
- 网易乐得开发的各个APP内嵌
- 网易知名APP（比如网易新闻客户端、易信等）内嵌
- 其他知名APP（比如微信）内嵌
- PC浏览器的有限支持

## 登录要求

你如果已经开通了内部corp邮箱服务，那就可以直接登录使用，用户名和密码就是你的corp邮箱和密码（即网易的`OpenId`认证系统）。

公司内网访问和非公司网络访问，登录要求是一样的，不需要额外的认证或者`VPN`登录，但并不排除后续对非公司网络进行`网易将军令`认证的可能。

同时后续也会单独支持 URS 登录，而且每个项目的登录配置都是可以调整的。

## 工具套装

`PageMaker`虽然功能强大，但仍然是术业有专攻，更多Maker系列工具或许你同样会感兴趣，这些工具的入口地址在[乐得前端工具平台](http://nfop.ms.netease.com)中都可以找到。

# 概念与名词

本章节重点介绍`PageMaker`工具中涉及到的一些概念、名词等，以帮助刚接触工具的同学做一些基本知识准备。

## OpenID

这是网易内部的通用登录认证系统，用户名是corp邮箱，密码是corp邮箱密码。很多内部系统或工具都采用`OpenID`认证，所以，你会经常看到这个熟悉的登录界面。

![OpenId登录界面](http://pimg1.126.net/nfop/upload/201711/fc11834e0d0b4f8e.png)

不同的工具和系统对`OpenID`登录的配置不同，除了用户名和密码，有的还要求`网易将军令`认证或者`VPN`登录。`PageMaker`仅仅要求corp用户名和密码登录即可。

您的corp邮箱，通常情况下，也是您的POPO帐号，有了这个帐号就可以完成邮件收发和POPO消息接收。

## 组件

组件是`PageMaker`中的基本概念，指的是一个功能模块，比如一个标题，一个按钮。组件按照复杂程度、使用频率、适用范围一共分为四类：

- **基础组件** 包括标题、图片、按钮、正文、音频、视频等组件，功能相对简单，使用频率高，所有项目通用；

- **扩展组件** 包括分组标题、动效图、轮播图、时间轴、倒计时等组件，功能较为复杂，使用频率高，所有项目通用；

- **高级组件** 包括二维码、品众铺码、选项列表、JSCSS等组件，这些组件使用有一定门槛和要求，需要在前端同学指导下使用，或由前端同学来配置；

- **私有组件** 该分类下默认没有组件，所有的私有组件都具有项目特殊性，由各个项目前端开发在线提交完成，比如活动资格领取组件。提交的私有组件对其他人不可见，默认不展示该分类，详细描述见[组件使用]；

## APP命令

`APP命令` 又称为 `客户端短链`、`客户端命令`、`客户端url`，是一个类似以下格式 `someapp://somewords?key=value` 的一个字符串。标准称呼是 `自定义 URL Scheme`，也就是自定义URL格式。由客户端同学定义并提供，不同的客户端对应的`APP命令`不同。

本工具中称之为 `APP命令`，全英文的写法为 `APPCmd`。

在很多组件的配置表格中，都有独立的 `APP命令` 输入框。其功能用于通知手机操作系统去打开APP并定位到某个功能页面（如果安装了APP的话）。`APP命令` 的更多说明请查看[奇淫技巧 - APP命令]。

## 发布

也称为『上线』或『发布上线』，在 `PageMaker` 编辑好页面内容后，点击『发布』按钮，设置目录等信息后，`PageMaker`将完成发布指令，将代码推送到线上服务器，并在发布完成后给予访问二维码和访问链接。

任何页面都需要在发布上线后才可以访问。发布后的页面跟预览效果可能会有一些的差异。发布信息会通知到操作者的POPO上，并在服务器上保留最近的发布日志。

## 导入

已经发布上线的页面可以通过『导入』功能将页面信息重新加载到 `PageMaker` 编辑区域进行修改。『导入』链接在内容配置区顶部，点击即可打开导入对话框。

导入的方式有很多种，可以参考[使用流程 - 导入修改]。

## 口令

为了防止已经发布的页面被他人误覆盖（的确发生过的这样的悲剧），所以在发布的时候可以选择设置一个密码口令，后续覆盖发布的时候需要提供同样的口令才可以完成覆盖发布。口令区分大小写，不限制长度和字符集。

重要的页面请务必设置口令来保护页面内容。

## 时光机车票

同样是为了解决页面被误覆盖的问题（自己有口令，但仍不小心覆盖了，这样的悲剧也发生过），特设置了一个特殊的字符串（比如 project/somepage#20171116172012），这个字符串会在页面发布完毕后发送到操作者的POPO中，这个字符串就是 `时光机车票`。

可以将 `时光机车票` 字符串贴到导入对话框中进行导入，可以在任意时候导入这个车票对应的页面版本，就算是页面被覆盖了，也可以通过 `时光机车票` 恢复页面内容，然后重新覆盖发布。

# 使用流程

## 登录

访问 `PageMaker` 即可以在需要时自动跳转到登录页面，登录成功后会自动返回原有页面。

## 界面介绍

在`PageMaker`主页面，主要包括的区域有：顶部操作区、组件列表、内容配置区、预览区。

![PageMaker主界面](http://pimg1.126.net/nfop/upload/201711/55965fb6c767c405.png)

当然，如果你的浏览器可用高度偏低的话，顶部条会知趣的移动到左侧，变成侧边条，以挪出更多的操作空间和预览区域。

## 编辑

`PageMaker`主页面就是编辑页面，中间部分为内容配置区，可以完成大部分的操作。

![内部配置区截图](http://pimg1.126.net/nfop/upload/201711/e7fc24c31ebc6c15.png)

- **增加组件** 点击组件列表中自己需要的组件，内容配置区就会增加并自动展开这个组件的配置表单；

- **配置组件** 填写或选择不同的配置，并在右侧预览区进行预览，直到满意为止；

- **修改组件备注** 每个组件配置表格的表头左侧，鼠标点击可以编辑，可以写入当前组件的简单描述，默认情况下显示的是组件的通用名字；备注名不会输出到要发布的页面中；

- **修改组件顺序** 每个组件配置表单的表头右侧，有一个拖动图标，点击拖拽到你需要的位置即可；

- **快速复制组件** 每个组件配置表单的表头右侧，有一个复制的图标，点击后可以在当前组件后面创建一个完全一样的组件；只可创建一个实例的组件除外；

- **设置默认值** 每个组件配置表单的表头右侧，有一个闪电图标，点击后，可以将当前组件的内容作为该组件的默认值，以后从组件列表新增的组件将都以此作为初始化内容；

- **恢复默认值** 设置默认值的图标，长按即可恢复组件默认值；

- **删除组件** 每个组件配置表单的表头右侧，有一个删除按钮，点击后进行二次确认，选择『删除』即可删除组件；

- **展开与折叠** 每个组件配置表单的表头右侧，有一个小剪头，点击可以展开或折叠配置表格；

> 编辑的时候，`PageMaker` 会将您的编辑状态随时保存到浏览器内，所以，你可以放心的刷新页面、关闭浏览器，所有页面信息都将保留，并在你下次打开 `PageMaker` 的时候自动载入。

## 设置

在编辑区域上方，有一个『设置』链接，点击可以打开设置面板。

![设置面板](http://pimg1.126.net/nfop/upload/201711/2d5453fda4c5b4a3.png)

- **拾色器** 用于设置颜色输入框的辅助工具种类；

- **折叠交互** 用于设置组件配置区面板折叠逻辑是否为互斥；

- **章鱼统计** 用于设置是否自动追加章鱼统计组件，项目未配置章鱼组件的，将没有这个设置；

- **全局动效** 用于设置是否自动追加全局动效组件；

- **自定义库** 用于设置JSCSS组件可以使用的组件代码，非开发人员勿动，项目未启用自定义库的，将没有这个设置；

- **私有组件** 用于设置项目私有的组件，非开发人员勿动，项目未启用私用组件的，将没有这个设置；

## 发布

编辑好的页面需要通过『发布』才可以完成上线工作。点击编辑区域顶部的『发布』按钮打开发布对话框：

![](http://pimg1.126.net/nfop/upload/201711/c6af7b4a57cfac2d.png)

- **发布目录**： 你的页面将发布到这个目录下，如果目录包含有 `test` 字样，则表示是测试内容，不会记录到发布日志中，并且后续可能会不定期删除；

- **目录存在**：选择当目录已经存在时的操作策略，如果是覆盖发布，需要选择 `强制发布` 选项；

- **设置口令**：以及**新口令**都是为保护页面被误覆盖而设置的，需要在覆盖发布时提供或设置；

- **预计路径**：页面即将发布后的url地址，随着 `发布目录` 的更改而变化；

配置好以上选项后，点击**立即发布**按钮后耐心等待程序处理，处理成功后，会弹出发布成功弹窗。

    发布过程中也可能会出现失败，多数情况下，请保持淡定，从容地再试一次。
    如果问题仍然存在，请在popo群（1322036）中反馈。

> 虽然多次发布没有什么严重影响，但会导致日志冗余、消息重复通知，所以，尽可能 **在确认预览没有问题后再发布**。

## POPO通知

由于采用了 `OpenId` 登录，您的帐号就是工作邮箱，也是POPO帐号，所以，`PageMaker` 可以在您成功发布页面后将发布的概要信息通知给您，方便您后续查询。大概您收到的通知是这个样子：

![POPO通知](http://pimg1.126.net/nfop/upload/201711/3216db8a873e216b.png)

如果发布的页面设置有口令，也会一并通知到POPO中。

## 导入修改

是的，导入修改已经发布的页面，是必不可少的功能。`PageMaker` 提供多种导入方式，您可以选一个让您用起来舒服的方式。点击内容配置区顶部的 `导入` 链接打开导入面板：

![导入面板](http://pimg1.126.net/nfop/upload/201711/5dd2853ccbb56b08.png)

- **上传json文件** 点击 `上传json配置` 按钮，选择json配置文件，即可导入（这个文件由 `导出` 链接提供下载）。可以将自己配置好的页面导出json传给其他人来用（不用发布）。[奇淫技巧 - 导出配置文件]中有更多说明；

- **完整json配置信息** 将完整json配置信息复制进来即可（似乎没有人这么干了）；

- **完整线上页面地址** 最常见的是将线上的 `完整url地址` 写入就可以导入；推荐使用；

- **发布目录名** 可以更简单的输入 `目录名` 即可，这是在发布时设置的，这个方式无疑是最简单的；强烈推荐；

- **时光机车票** 在发布完毕后的POPO消息通知中，会有一个时光机车票的信息给到你，将它贴入到这里，就可以导入对应的页面，哪怕那个页面已经被覆盖了，详见[奇淫技巧 - 时光机车票]。

## 查看发布日志

在内容配置区右上角，有一个 `发布日志` 的链接，点击后可打开发布日志页面。

![发布日志页面](http://pimg1.126.net/nfop/upload/201711/8c6ecb6ad1277618.png)

在页面的输入框中输入任何你关注的词或字符，工具会自动过滤出符合要求最近的发布记录。

> PageMaker 仅保留最近5000次记录（含有test字样的测试页面不计算在内）

## 订阅发布通知

如果项目配置了信使系统的发布通知了的话，你就可以在信使订阅PageMaker的发布情况，可以关注对应的消息主题：

[http://messenger.nfop.ms.netease.com](http://messenger.nfop.ms.netease.com)

选择相应主题后，点击『关注』即可。在关注主题后，会及时收到相关发布消息通知，而通知的方式，也可以随意定制，此不赘述。

## 页面恢复

页面发布错误或误覆盖，恢复方法有以下几种：

1. 重新制作页面，覆盖发布；
2. 导入线上页面，重新编辑后，覆盖发布；
3. 导入之前正确页面的 `时光机车票`，覆盖发布；

# 组件介绍

要告诉大家的是，组件可以随意使用，不仅免费，而且不会有什么坏的影响。自己多实际动手玩玩组件，是了解和掌握组件的最好方法。本来想写点帮助，但是组件经常升级、增加，所以组件使用帮助可能会存在一定时效性，甚至是错误。请以实际线上组件功能为准。

如果项目没有配置 APP识别，则多个组件中的功能可能不完整，比如 『在项目APP内隐藏』的配置将无法生效。

## 特色组件

比较具有特色的组件有：标题、视频、动效图、轮播图、时间轴、倒计时、APP下载、二维码、JSCSS。推荐多玩多试。

# 奇淫技巧

## APP命令

`APP命令` 的功能之前默认由乐得前端的 `AppCore` 组件提供支持的，现在已经更新为默认支持。发送的方式为创建一个专用的 iframe。如果项目是乐得系项目，则会使用 `AppCore` 组件来实现，并拥有 `AppCore` 的更多功能。

### 多组App命令解析

如果项目采用 `AppCore`作为 APP识别解析工具，则拥有多组APP同时解析能力。

独立的解析形式为 `ntescaipiao://hall`，其中`ntescaipiao://` 为各个项目APP独有的自定义协议头，每个APP不同，`//` 后的内容为资源定位信息。看起来有点类似普通的url地址（`http://hall`）。

而 `AppCore` 是支持多组 `App命令` 解析的，形式为多个独立`App命令`，以`||`连接到一起，大致是这个模样：`ntescaipiao://hall||ntesyyg://hall`，解析的顺序从前到后：

- 如果页面在客户端内嵌，会尝试匹配当前客户端对应的 `App命令`，如果匹配不到，则当做浏览器处理；
- 如果页面在浏览器中，仅仅会处理第一个 `App命令`；

### 自动尝试启动App

`App命令`配置后，可以自动识别在客户端内嵌以及浏览器环境，并做出不同的行为：

- 在客户端内嵌，如果`App命令`跟当前客户端匹配，则会启动客户端对应的功能页面，如果不匹配，则当做浏览器处理；
- 在浏览器中，会尝试发送一次`App命令`，多数情况下，手机操作系统会启动对应的客户端，但是页面脚本无法获知这一启动的结果，所以，在发送完毕`App命令，页面会跳转到配置的普通url地址去，以应对用户手机没有安装客户端的情况，而这个url地址通常情况下是客户端下载页面；
- 在微信内嵌中的处理比较特殊，由于微信限制很多，所以，在微信内基本上`App命令`不会生效，而是提示用户在浏览器中打开；

## 时光机车票

`时光机车票` 是一串标志页面历史状态的字符串，这个页面的配置信息在服务器上会保留一个副本，当使用 `时光机车票` 进行导入的时候，可以将这个历史副本加载并修改。所以：

**任何已经发布的页面都不会丢。**

`时光机车票` 可以在发布完毕页面后，从 `NFOP` 的POPO通知中获取，请注意保管。当然从发布日志页面中也可以找到相关信息。`时光机车票` 由以下信息组成：

`发布目录名`#`时间戳`

这两个信息可以确定一个发布过程，并定位到历史配置信息，导入`时光机车票` 就是通过这个逻辑找到服务器上的配置信息的。

## 导出配置文件

这是一个早期 `PageMaker` 的功能，一直被保留下来，虽然用的人不多了。点击内容配置区顶部的 `导出` 链接，可以下载当前页面的配置信息，这是一堆 `json` 代码，不用理会具体的内容。你可以：

> 将这个json配置文件传给其他同学，让他们『导入』到他们的页面中，这样就可以完成配置复制和转移的工作了。

> json配置中的私有组件也会随着配置一起转移和导入。
    
UED的同学可以借助这个功能提前制作一些模板配置，导出`json`配置文件后，发给产品和运营同学，他们直接导入使用即可。这样可以省去很多不必要的沟通，比如UED给产品讲解动效参数、页面间距啥的。

## 动态页面开发

`PageMaker` 是一个静态页面制作工具，这个所谓的 `静态` 指的仅仅是页面代码本身不可发生变化，但并意味着页面内容和逻辑不能变化。通过`javascript`、`jsonp`、`ajax`等基本前端技术，页面内容可以具备一定的动态逻辑，甚至开发一个整站，都是有可能的（的确出现过这个情况）。

同时项目配置的 `AppCore` 具有更多功能，使得页面的动态性可以通过简单的开发就可以完成，而常用的组件就是 `JSCSS` 组件。彩票项目的 `活动资格领取` 组件就是通过这个方式完成的。

## 章鱼统计

如果项目配置启用了章鱼统计组件，在 `PageMaker` 设置弹窗中，将『章鱼统计』项的值调整为『发布前自动追加』将会极大改善忘记添加统计组件带来的尴尬问题。首次发布的时候，也会在发布弹窗进行提示该功能。

## 渠道模式化配置

在《环境检测》、《APP下载》模块中，都有渠道配置信息，不同的渠道将表现出不一样的处理。通常情况下，可能是这么一组配置（以环境检测组件为例）：

    渠道： channel/tg1
    链接： https://some.url.163.com/luo_di_ye.html?from=tg1

2017年04月07日升级了渠道配置方法，可以支持灵活高效的模式化配置，现在请看以下配置：

    渠道： channel/tg1,channel/tg2
    链接： https://some.url.163.com/luo_di_ye.html?from={value}
    
    等同于以下两条配置之和：
    
    渠道： channel/tg1
    链接： https://some.url.163.com/luo_di_ye.html?from=tg1
    +
    渠道： channel/tg2
    链接： https://some.url.163.com/luo_di_ye.html?from=tg2
    

请注意以上的变化，渠道中以逗号分割，配置两个渠道信息，而链接中有一个`{value}`的占位符，其内容是当前匹配到的渠道号。也就是说：

1. **渠道可以一次配置多个，并且需要以逗号(全角或半角)或分号(全角或半角)分割；**
2. **`{value}`占位符的内容是动态的，取决于当前访问页面的渠道信息。**

再看一个例子：

    渠道： channel/tg1,channel/tg2
    链接： https://url/down?qudao={value}&plat=some
    
1. **`{value}`在链接中出现的位置，是不受限制的；**
2. **`{value}`占位符不是必须的。**

再来一个例子：

    渠道： from=tg1,from=tg2
    链接： https://url/down?qudao={value}&plat=some
    
1. **使用了`xxx=yyy`格式的渠道信息，这些信息将会从页面URL中提取；**
2. **使用了`xxx/yyy`格式的渠道信息，这些信息将会从浏览器或客户端内嵌的 UA 中提取信息。**

再来一个例子：

    渠道： from=tg1|tg2,channel/tg1|tg2
    链接： https://url/down?qudao={value}&plat=some
    
    等同于：
    
    渠道： from=tg1,from=tg2,channel/tg1,channel/tg2
    链接： https://url/down?qudao={value}&plat=some
    
1. **同样格式的配置，可以合并，渠道标记以竖线或全角顿号分割；**
2. **多组同格式的配置，仍然以逗号(全角或半角)或分号(全角或半角)分割。**

关于上面所有例子中提到的分隔符，可以使用半角的格式，也可以使用全角的格式：

    渠道： from=tg1、tg2，channel/tg1、tg2
    链接： https://url/down?qudao={value}&plat=some
    
    渠道： from=tg1、tg2；channel/tg1、tg2
    链接： https://url/down?qudao={value}&plat=some
    
当然，你也可以混着来，不过可能就不那么好看了。无论如何，程序都是可以识别上述这些配置的，并确保输出的页面和功能如你预期的那样执行。


## 自动重新发布

> 本功能仅仅对项目的超级管理员开放，用于重新发布特定页面以纠正某些组件的错误，或更新某些组件。入口在顶部条。

![自动重新发布](http://pimg1.126.net/nfop/upload/201711/df5e12d9d1526a70.png)

- 可以根据时间、组件来筛选发布的页面，如果所有条件都不设置，则查询所有发布的页面；
- 私有组件查询必须当前用户设置的有才可以；
- 自动重新发布不允许修改配置内容，工具会自动完成导入、覆盖发布、清空配置的过程；
- 自动重新发布的页面，在日志中会有 `REP` 标志。


