/* Class */
(function($){(function(g){var h=g.Class=function(){};function noop(){}h.prototype.log=h.prototype.warn=noop;if(g.console){h.prototype.log=function(){console.log&&console.log.apply(console,arguments)};h.prototype.warn=function(){console.warn&&console.warn.apply(console,arguments)}}var j=h.prototype.warn;h.prototype.callSuper=function(){j("父类没有同名方法，不能调用callSuper！")};h.extend=function extend(a,b){var c,checkResult,superPrototype=this.prototype;if(!b){b=a;a=""}if(typeof b!=="object"||!b.hasOwnProperty){j("继承类的原型数据错误！");return}var d=checkNameSpace(a);if(!d)return;c=new this();for(var e in b){if(b.hasOwnProperty(e)){if(typeof b[e]=="function"&&typeof superPrototype[e]=="function"){var f=superPrototype[e];if(!f.__isAgent){f=getAgentFn(getWarnFn(e+"方法被子类覆盖，但是父类没有同名函数，不能调用callSuper!"),superPrototype[e])}c[e]=getAgentFn(f,b[e])}else{c[e]=b[e]}}}function subClass(){}subClass.prototype=c;subClass.prototype.constructor=subClass;subClass.extend=extend;subClass.create=create;d(subClass);return subClass};function create(){var a=new this();if(a.init){a.init.apply(a,arguments)}return a}function checkNameSpace(b){if(!b){return noop}if(!/^(?:Base|Tools|Widgets|Game|Page)\./.test(b)){return j("Class命名空间错误，一级命名空间只能是:Base、Tools、Widgets、Game、Page")}var c=b.split("."),n=c.length,i=0,path=h,name;for(;i<n-1;i++){name=c[i];path=path[name]=path[name]||{}}name=c[n-1];if(path[name]){return j("已经有同名Class存在，请更换名称或路径！")}return function(a){path[name]=a}}function getAgentFn(b,c){var d=function(){var a=this.hasOwnProperty("callSuper"),tmp=this.callSuper,ret;this.callSuper=b;ret=c.apply(this,arguments);if(!a){delete this.callSuper}else{this.callSuper=tmp}return ret};d.__isAgent=true;return d}function getWarnFn(a){return function(){j(a)}}})(window);(function(f){var g=Array.prototype.slice,toString=Object.prototype.toString,noop=function(){},MUID=1,isFunction=function(a){return toString.call(a)=="[object Function]"};var h=f.extend({init:function(){this.eventCache=this.eventCache||{}},createEvent:function(c,d){if(typeof c!=="string"){return}var e=this,cache=e.eventCache;$.each(c.split(" "),function(i,b){cache[b]=cache[b]||[];d&&(e[b]=function(a){if(isFunction(a)){e.bind(b,a);return this}else{return e.trigger.apply(e,[b].concat(g.call(arguments,0)))}})})},trigger:function(b,c){var d,falseNum=0,com=this,para=g.call(arguments,1);if(!isNaN(b)&&b&&+b>0){if(typeof c!=="string")return 1;d=this.eventCache[c||""];if(!d)return 2;if(!d.length)return 0;d.paras=para;if(!d.t){d.t=window.setTimeout(function(){delete d.t;com.trigger.apply(com,d.paras)},parseInt(b,10)||200)}return 0}if(typeof b==="number"&&(isNaN(b)||b<0)){if(typeof(c)!=="string")return 1;d=this.eventCache[c||""];if(d){this.warn("事件"+c+"设置的缓冲保护时间不是合法数字")}}else{if(typeof(b||c)!=="string")return 1;d=this.eventCache[b||c||""]}if(!d)return 2;$.each(d.slice(0),function(i,a){try{if(a.apply(com,para)===false){falseNum++}}catch(e){com.log(e);return}});return falseNum?false:0},bind:function(a,b){if(typeof a!=="string")return 1;var c=this.eventCache[a];if(!c)return 2;if(!isFunction(b))return 3;b.muid=b.muid||MUID++;c.push(b);return 0},unbind:function(a,b){if(arguments.length===0){this.eventCache={};return 0}if(typeof a!=="string")return 1;var c=this.eventCache[a||""];if(!c)return 2;if(b===undefined){c.length=0;return this}if(!isFunction(b))return 3;for(var i=0;i<c.length;i++){if(c[i]===b||(b.muid&&c[i].muid===b.muid)){c.splice(i,1);i--}}return 0},bindOnce:function(b,c){if(typeof b!=="string")return 1;var d=this.eventCache[b],com=this;if(!d)return 2;if(!isFunction(c))return 3;var e=function(){var a=c.apply(this,arguments);com.unbind(b,e);return a};e.muid=c.muid=(c.muid||MUID++);return com.bind(b,e)}});f.extend("Base.Message",{init:function(){this.__agent=this.__agent||h.create()},bindMsg:function(a,b,c,d){if(!a||!isFunction(b)){return this}this.__agent.createEvent(a);var e=c?function(){return b.apply(c,arguments)}:function(){return b.apply(window,arguments)};e.muid=b.muid;this.__agent[d?"bindOnce":"bind"](a,e);b.muid=e.muid;return this},bindMsgOnce:function(a,b,c){return this.bindMsg(a,b,c,1)},unbindMsg:function(a){if(!a){return this}this.__agent.unbind.apply(this.__agent,arguments);return this},sendMsg:function(a){this.__agent.trigger.apply(this.__agent,arguments);return this}});(function($,b){var c=f.Base.Message.create();$.each(["bindMsg","bindMsgOnce","unbindMsg","sendMsg"],function(i,a){b[a]=$[a]=function(){c[a].apply(c,arguments);return this}})})($||window.jQuery||window.Zepto,window.Zepto||window);h.extend("Base.Event",{init:function(a){this.callSuper();this.createEvent(a,true);this.createEvent=noop},trigger:function(a){var b=this.callSuper.apply(this,arguments);if(b&&!isNaN(b)){this.warn(["trigger事件名称必须是字符串","未注册的事件("+a+")不能trigger"][b-1])}if(b===false){return false}},bind:function(a){var b=this.callSuper.apply(this,arguments);if(b){this.warn(["bind事件名称必须是字符串","未注册的事件("+a+")不能bind","bind("+a+")注册事件必须是函数"][b-1])}return this},unbind:function(a){if(!a){this.warn("暂不支持全部事件一次性卸载");return this}this.callSuper.apply(this,arguments);return this},bindOnce:function(a){var b=this.callSuper.apply(this,arguments);if(b){this.warn(["bindOnce事件名称必须是字符串","未注册的事件("+a+")不能bindOnce","bindOnce("+a+")注册事件必须是函数"][b-1])}return this}})})(window.Class)})(window.Zepto||window.jQuery);